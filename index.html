<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>≈ûafak Vakti</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --accent: #38bdf8; --bg: #0f172a; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding-bottom: 90px; overflow-x: hidden; }
        
        #duyuru-bar { padding: 12px; font-weight: bold; text-align: center; display: none; position: sticky; top: 0; z-index: 100; }
        
        .header { padding: 40px 20px; text-align: center; }
        .timer { font-size: 4rem; font-weight: 800; color: var(--accent); margin: 10px 0; text-shadow: 0 0 20px rgba(56, 189, 248, 0.3); }
        
        .main-container { background: #f1f5f9; color: var(--text); border-top-left-radius: 35px; border-top-right-radius: 35px; padding: 25px 15px; min-height: 100vh; }
        
        .vakit-grid { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; -ms-overflow-style: none; }
        .vakit-grid::-webkit-scrollbar { display: none; }
        .vakit-item { min-width: 85px; background: white; padding: 15px 5px; border-radius: 20px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.02); transition: 0.3s; }
        .vakit-item.active { border: 2.5px solid var(--accent); background: #e0f2fe; transform: scale(1.05); }
        
        .pro-card { border-radius: 22px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); position: relative; transition: 0.3s; border: 1px solid rgba(0,0,0,0.05); }
        .card-tag { font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; color: #64748b; }
        .card-text { font-size: 1.05rem; line-height: 1.6; font-weight: 600; color: #1e293b; }
        
        .share-btn { margin-top: 15px; background: rgba(0,0,0,0.05); border: none; padding: 10px 18px; border-radius: 12px; font-size: 0.85rem; font-weight: 700; cursor: pointer; color: #475569; display: flex; align-items: center; gap: 8px; }
        .share-btn:active { background: rgba(0,0,0,0.1); }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 20px; border-top: 1px solid #e2e8f0; z-index: 1000; }
        .nav-item { color: #94a3b8; font-size: 1.4rem; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--accent); transform: translateY(-5px); }
    </style>
</head>
<body>

<div id="duyuru-bar"></div>

<div id="page-content">
    <div class="header">
        <h2 style="margin:0; letter-spacing: 1px;">Ceylanpƒ±nar</h2>
        <div class="timer" id="countdown">00:00:00</div>
        <div id="h-date" style="opacity:0.8; font-weight: 600;">Y√ºkleniyor...</div>
    </div>

    <div class="main-container">
        <div class="vakit-grid" id="vakit-list"></div>

        <div id="cards-area">
            <div class="pro-card" id="bg-ayet">
                <div class="card-tag"><i class="fas fa-book-open"></i> Vaktin Ayeti</div>
                <div class="card-text" id="txt-ayet">...</div>
                <button class="share-btn" onclick="paylas('Vaktin Ayeti', 'txt-ayet')"><i class="fas fa-paper-plane"></i> Payla≈ü</button>
            </div>

            <div class="pro-card" id="bg-hadis">
                <div class="card-tag"><i class="fas fa-mosque"></i> Vaktin Hadisi</div>
                <div class="card-text" id="txt-hadis">...</div>
                <button class="share-btn" onclick="paylas('Vaktin Hadisi', 'txt-hadis')"><i class="fas fa-paper-plane"></i> Payla≈ü</button>
            </div>

            <div class="pro-card" id="bg-esma" style="background: linear-gradient(135deg, #0ea5e9, #2563eb); color: white;">
                <div class="card-tag" style="color:white; opacity: 0.9;"><i class="fas fa-star"></i> Esma√ºl H√ºsna</div>
                <div class="card-text" id="txt-esma" style="font-size: 1.3rem; text-align:center; font-weight: 800; padding: 10px 0;">...</div>
            </div>

            <div class="pro-card" id="bg-dua">
                <div class="card-tag"><i class="fas fa-hands-praying"></i> G√ºnl√ºk Dua</div>
                <div class="card-text" id="txt-dua">...</div>
                <button class="share-btn" onclick="paylas('G√ºnl√ºk Dua', 'txt-dua')"><i class="fas fa-paper-plane"></i> Payla≈ü</button>
            </div>

            <div class="pro-card" id="bg-bilgi">
                <div class="card-tag"><i class="fas fa-lightbulb"></i> G√ºn√ºn Bilgisi</div>
                <div class="card-text" id="txt-bilgi">...</div>
                <button class="share-btn" onclick="paylas('G√ºn√ºn Bilgisi', 'txt-bilgi')"><i class="fas fa-paper-plane"></i> Payla≈ü</button>
            </div>
        </div>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item active"><i class="fas fa-home"></i></div>
    <div class="nav-item"><i class="fas fa-compass"></i></div>
    <div class="nav-item"><i class="fas fa-book"></i></div>
    <div class="nav-item"><i class="fas fa-cog"></i></div>
</nav>

<script>
    // Firebase Config (Kendi bilgilerinle kontrol et)
    const firebaseConfig = {
        apiKey: "AIzaSyC6VtB6eHqiNNyoJ0x4yCpnGChB6p9AYnM",
        authDomain: "safakvakti-5f929.firebaseapp.com",
        projectId: "safakvakti-5f929",
        storageBucket: "safakvakti-5f929.firebasestorage.app",
        messagingSenderId: "1089272374742",
        appId: "1:1089272374742:web:bc422dad721627342fb077"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Service Worker Kaydƒ±
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }

    const vNames = { Fajr:"ƒ∞msak", Sunrise:"G√ºne≈ü", Dhuhr:"√ñƒüle", Asr:"ƒ∞kindi", Maghrib:"Ak≈üam", Isha:"Yatsƒ±" };
    let vTimes = {};
    const ezanSesi = new Audio('https://www.islamicfinder.org/prayer-times/sounds/adhan/Makkah.mp3');

    async function init() {
        try {
            const res = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Ceylanpinar&country=Turkey&method=13');
            const d = await res.json();
            vTimes = d.data.timings;
            document.getElementById('h-date').innerText = d.data.date.hijri.day + " " + d.data.date.hijri.month.tr || d.data.date.hijri.month.en + " " + d.data.date.hijri.year;
            
            const list = document.getElementById('vakit-list');
            list.innerHTML = "";
            Object.keys(vNames).forEach(k => {
                list.innerHTML += `<div class="vakit-item" id="v-${k}"><div style="font-size:0.75rem; font-weight:bold; color:#64748b">${vNames[k]}</div><div style="font-size:1.1rem; font-weight:800; margin-top:5px; color:#1e293b">${vTimes[k]}</div></div>`;
            });
            setInterval(counter, 1000);
            syncWithFirebase();
            Notification.requestPermission();
        } catch (e) { console.log("Hata: ", e); }
    }

    function counter() {
        const now = new Date();
        let next = null; let nextK = "";
        Object.keys(vNames).forEach(k => {
            const [h, m] = vTimes[k].split(':');
            let v = new Date(); v.setHours(h, m, 0);
            if (v < now) v.setDate(v.getDate() + 1);
            if (!next || (v - now) < (next - now)) { next = v; nextK = k; }
            document.getElementById(`v-${k}`).classList.remove('active');
        });
        
        const diff = next - now;
        const h = Math.floor(diff/3600000); const m = Math.floor((diff%3600000)/60000); const s = Math.floor((diff%60000)/1000);
        const kalanText = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        document.getElementById('countdown').innerText = kalanText;
        document.getElementById(`v-${nextK}`).classList.add('active');

        // √úst Paneli G√ºncelle (Her dakikada bir)
        if (s === 0) {
            updateOngoingNotification(kalanText, vNames[nextK]);
        }

        // Ezan Oku
        if (h === 0 && m === 0 && s === 0) {
            ezanSesi.play();
        }
    }

    function updateOngoingNotification(sure, vakit) {
        if ('serviceWorker' in navigator && Notification.permission === 'granted') {
            navigator.serviceWorker.ready.then(reg => {
                reg.showNotification("≈ûafak Vakti - Ceylanpƒ±nar", {
                    body: `${vakit} vaktine ${sure} kaldƒ±.`,
                    icon: 'icon.png',
                    tag: 'vakit-guncelleme',
                    ongoing: true,
                    silent: true
                });
            });
        }
    }

    function syncWithFirebase() {
        db.collection("icerik").doc("guncel").onSnapshot(doc => {
            if(doc.exists) {
                const data = doc.data();
                const config = [
                    {key:'ayet', txt:'txt-ayet', bg:'bg-ayet'},
                    {key:'hadis', txt:'txt-hadis', bg:'bg-hadis'},
                    {key:'esma', txt:'txt-esma', bg:'bg-esma'},
                    {key:'dua', txt:'txt-dua', bg:'bg-dua'},
                    {key:'bilgi', txt:'txt-bilgi', bg:'bg-bilgi'}
                ];
                config.forEach(item => {
                    document.getElementById(item.txt).innerText = data[item.key] || "...";
                    if(data[item.key+'R']) document.getElementById(item.bg).style.backgroundColor = data[item.key+'R'];
                });
                const dBar = document.getElementById('duyuru-bar');
                if(data.duyuru) {
                    dBar.innerText = "üì¢ " + data.duyuru;
                    dBar.style.backgroundColor = data.duyuruR || "#e94560";
                    dBar.style.display = "block";
                } else { dBar.style.display = "none"; }
            }
        });
    }

    function paylas(baslik, elementId) {
        const icerik = document.getElementById(elementId).innerText;
        const mesaj = `üìç *≈ûafak Vakti - ${baslik}*\n\n"${icerik}"\n\n_Ceylanpƒ±nar Namaz Vakitleri_`;
        if (navigator.share) {
            navigator.share({ title: '≈ûafak Vakti', text: mesaj });
        }
    }

    init();
</script>
</body>
</html>
